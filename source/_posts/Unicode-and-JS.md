---
title: Unicode and JS
date: 2018-01-28 19:13:25
tags: 
    - JavaScript
---

ä¹‹å‰å¤„ç†ä¸­æ–‡å­—ç¬¦ä¸emojiæ—¶é‡åˆ°äº†ä¸€äº›å‘ï¼ŒæŸ¥é˜…äº†èµ„æ–™æ•´ç†äº†ä¸€ä¸‹è¦ç‚¹ã€‚

<!-- more -->

### Unicode

Unicodeæ˜¯ç›®å‰ç»å¤§å¤šæ•°ç¨‹åºä½¿ç”¨çš„å­—ç¬¦ç¼–ç ï¼Œå®šä¹‰ä¹Ÿå¾ˆç®€å•ï¼Œç”¨ä¸€ä¸ªç ç‚¹(code point)æ˜ å°„ä¸€ä¸ªå­—ç¬¦ã€‚ç ç‚¹å€¼çš„èŒƒå›´æ˜¯ä»U+0000åˆ°U+10FFFFï¼Œå¯ä»¥è¡¨ç¤ºè¶…è¿‡110ä¸‡ä¸ªç¬¦å·ã€‚Unicodeæºäºä¸€ä¸ªå¾ˆç®€å•çš„æƒ³æ³•ï¼šå°†å…¨ä¸–ç•Œæ‰€æœ‰çš„å­—ç¬¦åŒ…å«åœ¨ä¸€ä¸ªé›†åˆé‡Œï¼Œè®¡ç®—æœºåªè¦æ”¯æŒè¿™ä¸€ä¸ªå­—ç¬¦é›†ï¼Œå°±èƒ½æ˜¾ç¤ºæ‰€æœ‰çš„å­—ç¬¦ï¼Œå†ä¹Ÿä¸ä¼šæœ‰ä¹±ç äº†ã€‚

ç›®å‰ï¼ŒUnicodeçš„æœ€æ–°ç‰ˆæœ¬æ˜¯7.0ç‰ˆï¼Œä¸€å…±æ”¶å…¥äº†109449ä¸ªç¬¦å·ï¼Œå…¶ä¸­çš„ä¸­æ—¥éŸ©æ–‡å­—ä¸º74500ä¸ªã€‚å¯ä»¥è¿‘ä¼¼è®¤ä¸ºï¼Œå…¨ä¸–ç•Œç°æœ‰çš„ç¬¦å·å½“ä¸­ï¼Œä¸‰åˆ†ä¹‹äºŒä»¥ä¸Šæ¥è‡ªä¸œäºšæ–‡å­—ã€‚æ¯”å¦‚ï¼Œä¸­æ–‡"å¥½"çš„ç ç‚¹æ˜¯åå…­è¿›åˆ¶çš„597Dã€‚

Unicodeæœ€å‰é¢çš„65536ä¸ªå­—ç¬¦ä½ï¼Œç§°ä¸ºåŸºæœ¬å¹³é¢ï¼ˆBMP-â€”Basic Multilingual Planeï¼‰ï¼Œå®ƒçš„ç ç‚¹èŒƒå›´æ˜¯ä»U+0000åˆ°U+FFFFã€‚æœ€å¸¸è§çš„å­—ç¬¦éƒ½æ”¾åœ¨è¿™ä¸ªå¹³é¢ï¼Œè¿™æ˜¯Unicodeæœ€å…ˆå®šä¹‰å’Œå…¬å¸ƒçš„ä¸€ä¸ªå¹³é¢ã€‚ 
å‰©ä¸‹çš„å­—ç¬¦éƒ½æ”¾åœ¨è¡¥å……å¹³é¢ï¼ˆSupplementary Planeï¼‰ï¼Œç ç‚¹èŒƒå›´ä»U+010000ä¸€ç›´åˆ°U+10FFFFï¼Œå…±16ä¸ªã€‚

### JSçš„ç¼–ç 

UTFï¼ˆUnicode transformation formatï¼‰Unicodeè½¬æ¢æ ¼å¼ï¼Œæ˜¯æœåŠ¡äºUnicodeçš„ï¼Œç”¨äºå°†ä¸€ä¸ªUnicodeç ç‚¹è½¬æ¢ä¸ºç‰¹å®šçš„å­—èŠ‚åºåˆ—ã€‚å¸¸è§çš„UTFæœ‰

```
UTF-8 å¯å˜å­—èŠ‚åºåˆ—ï¼Œç”¨1åˆ°4ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç ç‚¹ 
UTF-16 å¯å˜å­—èŠ‚åºåˆ—ï¼Œç”¨2æˆ–4ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç ç‚¹ 
UTF-32 å›ºå®šå­—èŠ‚åºåˆ—ï¼Œç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç ç‚¹
```

UTF-8å¯¹ASCâ…¡ç¼–ç æ˜¯å…¼å®¹çš„ï¼Œéƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œè¶…è¿‡U+07FFçš„éƒ¨åˆ†åˆ™ç”¨äº†å¤æ‚çš„è½¬æ¢æ–¹å¼æ¥æ˜ å°„Unicodeã€‚

ç„¶è€Œjsç”¨çš„ç¼–ç å´æ˜¯å·²ç»è¿‡æ—¶äº†çš„UCS-2

```
1990 UCS-2 è¯ç”Ÿ 
1995.5 JavaScript è¯ç”Ÿ 
1996.7 UTF-16 è¯ç”Ÿ
```

ä¹Ÿå°±æ˜¯è¯´ï¼ŒBrendan Eichåœ¨å†™JSçš„æ—¶å€™ï¼ŒUTF-16è¿˜æ²¡é—®ä¸–ï¼Œæ‰€ä»¥åªèƒ½ç”¨UCS-2çš„æ–¹å¼æ¥å¤„ç†å­—ç¬¦ï¼Œä¹Ÿå› æ­¤ç•™ä¸‹äº†éšæ‚£ã€‚

### æ½œåœ¨çš„é—®é¢˜

#### lengthå±æ€§

emojiç­‰16ä½çš„å­—ç¬¦çš„é•¿åº¦ä¼šè¢«è®¤ä¸ºæ˜¯2ï¼Œsliceç­‰å‡½æ•°ä¹Ÿä¼šå› æ­¤å‡ºç°é—®é¢˜

```js
'ğŸ˜€'.length // 2

// æ­£ç¡®æ–¹æ³•
Array.from('ğŸ˜€').length

'ğŸ˜€ğŸ˜€'.slice(0,1) // "ï¿½"

'ğŸ˜€ğŸ˜€'.slice(0,2) // "ğŸ˜€"
```

ä½¿ç”¨æ­£åˆ™åŒ¹é…ï¼Œå°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°ç»„ï¼Œå¯è§£å†³è¯¥é—®é¢˜

```js
const slice = (str, start, end) => {
  const arr = str.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g) || []
  return arr.slice(start, end).join('')
}

slice('ğŸ˜€ğŸ˜€',0,1) // ğŸ˜€
```

ES6å¯ä»¥è‡ªåŠ¨è¯†åˆ«4å­—èŠ‚çš„ç ç‚¹ï¼Œéå†å­—ç¬¦ä¸²çš„æ–¹æ³•
```js
for (let s of string ) {
  // ...
}
```
#### ç ç‚¹ä¸å­—ç¬¦äº’è½¬

String.fromCharCodeå¯ä»¥å°†ä¸€ä¸ªç ç‚¹è½¬æ¢ä¸ºå­—ç¬¦,charCodeAtåˆ™åä¹‹ã€‚

ä½†æ˜¯ç”¨åœ¨emojiä¸Šå°±ä¼šå‡ºé—®é¢˜ï¼Œè¦ä½¿ç”¨es6çš„fromCodePointå’ŒcodePointAtæ‰è¡Œ


```js
'å¥½'.charCodeAt(0).toString(16) // '597d'
String.fromCharCode(0x597d) // å¥½


/* error */
'ğŸ˜€'.charCodeAt(0).toString(16) //d83d
'ğŸ˜€'.codePointAt(0).toString(16) // 1f600

/* correct */
String.fromCharCode(0x1f600) // 'ï˜€'
String.fromCodePoint(0x1f600) // 'ğŸ˜€'
```

#### æ­£åˆ™åŒ¹é…

æ­£åˆ™åŒ¹é…ç¬¦.åªèƒ½åŒ¹é…å•ä¸ªâ€œå­—ç¬¦â€ï¼Œä½†jså°†ä»£ç†å¯¹å½“æˆä¸¤ä¸ªå•ç‹¬çš„â€œå­—ç¬¦â€å¤„ç†ï¼Œæ‰€ä»¥åŒ¹é…ä¸åˆ°ä»»ä½•è¾…åŠ©å¹³é¢å­—ç¬¦ã€‚
ES6é€šè¿‡å¢åŠ ä¸€ä¸ªuæ ‡å¿—æ¥è§£å†³è¿™ä¸ªé—®é¢˜

```js
/foo.bar/u.test('fooğŸ˜€bar')
```

### æ±‰å­—ç¼–ç 

Unicodeä¸­çš„æ±‰å­—æ˜¯CJKç»Ÿä¸€æ±‰å­—ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­£åˆ™åˆ¤æ–­å­—ç¬¦æ˜¯å¦åŒ…å«æ±‰å­—

```js
const isCJK = /[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g
'somestring'.test(isCJK) // false
'somestringå•Š'.test(isCJK) // true
```

äº§ç”Ÿéšæœºçš„æ±‰å­—

```js
/* produce random chinese words */
Array.from({ length: Math.random() * 10 + 1 }).map(() => String.fromCharCode(0x597D - Math.random() * 100))
```